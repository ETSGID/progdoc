<script src="<%=contextPath%>/js/autocomplete.js"></script>
<%- include cumplimentar.ejs %>
<div id="hermanoNuevoProfesorForm" class="contenido2">
<form id="asignacionCumplimentarForm" autocomplete="off" action="<%= nuevopath %>" method="post" >
<div class="myHeader2 sticky">
  <input type='submit' value='Guardar'>
  <button type="button" onclick="Volver('<%= cancelarpath %>')">Cancelar</button>
</div>
<input  type="hidden" id="plan" value="<%=session.planID%>">
<input type="hidden" id="selectPlan" value="<%=session.planID%>">
<input type="hidden" name="asignaturaId" value="<%= asign.identificador %>">
<% if (asign.acronimo !== null){ %>
  <h1><span title="<%=asign.nombre%> (<%=asign.codigo%>)"><%= asign.acronimo %></span></h1>
  <% }else{%>
  <h1><span title="<%=asign.nombre%> (<%=asign.codigo%>)"><%= asign.nombre %></span></h1>
  <% }%>

<ul style="list-style-type:none">
    <li>Coordinador:
    <div class="autocomplete" style="width:500px;">
    <input id="coordinador" type="text" name="coordinador" value="<%= asign.coordinador.nombreCorregido %>" placeholder="<%= asign.coordinador.nombreCorregido %>" onclick= 'LimpiaCoordinador()'>
    </div>
    <span><button type="button" onclick="EliminarCoordinador()">Eliminar</button></span>
    </li>
    <!-- Si el estado es N la asignacion se hace por grupo comun -->
    <%if(asign.estado === "N") {
        if(asign.grupos.length > 1){ %>
          <li>
          <h2> <span> Grupo Común: </span></h2>
        <ul style="list-style-type:none">
        <%for(let j=0; j< asign.grupos[0].profesors.length; j++){ %>
        <li id="asignacion_<%= asign.grupos[0].profesors[j].asignacion %>">
        <%= asign.grupos[0].profesors[j].nombreCorregido %> <button type="button" onclick="Eliminar('asignacion_<%= asign.grupos[0].profesors[j].asignacion %>')">Eliminar</button>
        </li>
      <% } %>
      <div id = 'anadir_profesor_<%= asign.grupos[0].GrupoId %>'></div>
      <button type="button" onclick="AnadirProfesor('anadir_profesor_<%= asign.grupos[0].GrupoId %>')">Añadir Profesor</button>
          </ul>
          </li>
        <%}%>
    <%} else {%>
      <% for(let i=0; i< asign.grupos.length; i++){ %>
          <li>
        <% if (asign.grupos[i].grupoPerteneciente === true){%>
          <h2> <span> Grupo <%= asign.grupos[i].GrupoNombre %>  <%= asign.grupos[i].nombreItinerario %>: </span></h2>
        <%} else{%>
            <h2> <span class="cuidado"> Grupo <%= asign.grupos[i].GrupoNombre %>  <%= asign.grupos[i].nombreItinerario %>: </span></h2>
        <%}%>
        <ul style="list-style-type:none">
        <%for(let j=0; j< asign.grupos[i].profesors.length; j++){ %>
        <li id="asignacion_<%= asign.grupos[i].profesors[j].asignacion %>">
        <%= asign.grupos[i].profesors[j].nombreCorregido %> <button type="button" onclick="Eliminar('asignacion_<%= asign.grupos[i].profesors[j].asignacion %>')">Eliminar</button>
        </li>
      <% } %>
      <div id = 'anadir_profesor_<%= asign.grupos[i].GrupoId %>'></div>
      <button type="button" onclick="AnadirProfesor('anadir_profesor_<%= asign.grupos[i].GrupoId %>')">Añadir Profesor</button>
          </ul>
          </li>
    <% }
  } %>

    </ul>
</form> 
</div>
<%- include nuevoProfesor.ejs %>

<script>
let form = document.getElementById("asignacionCumplimentarForm")
let numeroIncrementable = 0;
let profesores = <%- JSON.stringify(profesores) %>
let profesores2 = quitAcents(profesores)

autocomplete(document.getElementById("coordinador"), profesores, profesores2);

function Eliminar(id) {
   document.getElementById(id).innerHTML = '<input name="eliminar" id="momentaneo" type="hidden" value="">'
   let memomentaneo = document.getElementById(momentaneo)
   momentaneo.setAttribute('value', "eliminar_"+id) 
   momentaneo.setAttribute('id', "") 
}

function Eliminar2(id){
  let input = document.getElementById(id);
  let liste = document.getElementById("list_"+id);
  input.parentNode.removeChild(input);
  liste.parentNode.removeChild(liste);
  
}

function EliminarCoordinador(){
 document.getElementById('coordinador').setAttribute('value', "NO ASIGNADO");
 document.getElementById('coordinador').setAttribute('placeholder', "NO ASIGNADO");

}

function AnadirProfesor(id){
 let div = document.createElement('div');
  div.innerHTML = '<div id="'+id+'_vacio" class="autocomplete" style="width:500px;"><input id="momentaneo" type="text" name="vacio" value="" placeholder="Seleccionar Profesor"></div>'
  let node = div.firstChild;
  /*No se puede usar innerHtml directamente pq si añades varios buscadores en un mismo grupo desaparece la funcionalidad de los primeros
  buscadores. Con javascript debes crear primero un elemento, la forma más sencislla para hacerlo con un string es esa
  Alternativaemtne se podría hacer con jquery así
  */
  //$( "#"+id ).append('<div class="autocomplete" style="width:500px;"><input id="momentaneo" type="text" name="anadir" value="" placeholder="Seleccionar Profesor"></div> ' ); 
  let contenedor = document.getElementById(id)
  //solo permite un input por grupo hasta que se rellene
  if(!document.getElementById(id+"_vacio")){
   contenedor.appendChild(node)
   let memomentaneo = document.getElementById(momentaneo)
   momentaneo.setAttribute('id', numeroIncrementable)
   document.getElementById(numeroIncrementable).focus();
   autocomplete(document.getElementById(numeroIncrementable), profesores, profesores2, 'asignacionProfesores');
   numeroIncrementable++; 
  }
     
}

function Volver(cancelarpath){
  window.location.replace(cancelarpath);
}

function LimpiaCoordinador(){
  document.getElementById('coordinador').setAttribute('value', "");
}

</script>